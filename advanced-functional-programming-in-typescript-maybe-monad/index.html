<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!--Description-->
  
  <meta name="description" content="With this post, I would like to start a short series about monads. If you are familiar with some functional programming techniques in JavaScript (such">
  

  <!--Author-->
  
  <meta name="author" content="Miłosz Piechocki">
  

  <!--Open Graph Title-->
  
  <meta property="og:title" content="Advanced functional programming in TypeScript: Maybe monad">
  

  <!--Open Graph Description-->
  

  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="codewithstyle.info">

  <!--Type page-->
  
  <meta property="og:type" content="article">
  

  <!--Page Cover-->
  
  <meta name="twitter:card" content="summary">
   

  <!-- Title -->
  
  <title>Advanced functional programming in TypeScript: Maybe monad - codewithstyle.info</title>

  <!-- Tachyons Core CSS -->
  <link rel="stylesheet" href="//unpkg.com/tachyons/css/tachyons.min.css">

  <!-- Custom Fonts -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

  
  <link rel="amphtml" href="https://codewithstyle.info/advanced-functional-programming-in-typescript-maybe-monad//amp/index.html">
  

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/style.css">

  <!-- Google Analytics -->
  
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-89535231-1', 'auto');
        ga('send', 'pageview');

    </script>



  <!-- Twitter -->
  <script>
    window.twttr = (function (d, s, id) {
      var js,
        fjs = d.getElementsByTagName(s)[0],
        t = window.twttr || {};
      if (d.getElementById(id)) return t;
      js = d.createElement(s);
      js.id = id;
      js.src = "https://platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js, fjs);

      t._e = [];
      t.ready = function (f) {
        t._e.push(f);
      };

      return t;
    })(document, "script", "twitter-wjs");
  </script>

  <!-- MailerLite Universal -->
  <script>
    (function (m, a, i, l, e, r) {
      m["MailerLiteObject"] = e;
      function f() {
        var c = { a: arguments, q: [] };
        var r = this.push(c);
        return "number" != typeof r ? r : f.bind(c.q);
      }
      f.q = f.q || [];
      m[e] = m[e] || f.bind(f.q);
      m[e].q = m[e].q || f.q;
      r = a.createElement(i);
      var _ = a.getElementsByTagName(i)[0];
      r.async = 1;
      r.src = l + "?v" + ~~(new Date().getTime() / 1000000);
      _.parentNode.insertBefore(r, _);
    })(
      window,
      document,
      "script",
      "https://static.mailerlite.com/js/universal.js",
      "ml"
    );

    var ml_account = ml("accounts", "1785990", "w8k8t0a5z1", "load");
  </script>
  <!-- End MailerLite Universal -->
</head>


<body>

<!-- Main Content -->
<!-- Banner -->
<!-- Banner -->
<div class="w-100 bg-1 text-light">
  <div class="w-100">
    <nav class="db flex-l pv3 mw8 center items-center-l">
      <a class="db v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="codewithstyle.info">
        <img src="/images/2017/07/CODE-WITHSTYLE-1.png" class="dib h3" alt="codewithstyle.info">
      </a>
      <div class="db v-mid w-100 w-75-l tc tr-l">
        
        <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/toc" title="Table of Contents">
          Table of Contents
        </a>
        
        <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/tags/typescript" title="TypeScript">
          TypeScript
        </a>
        
        <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/functional-programming" title="Functional Programming">
          Functional Programming
        </a>
        
        <a class="link dim f6 f5-l dib mr3 mr4-l white" href="http://miloszpiechocki.com/" title="Author">
          Author
        </a>
        
      </div>
    </nav>
  </div>

  <!-- Title -->
  <div class="w-100 vh-40 dt" style="background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
    url('images/homepage.png'); background-size: cover; background-position: center">
    <div class="v-mid white center mw8">
      <h1 class="f1-l f2-m tc tc-m tl-ns">Advanced functional programming in TypeScript: Maybe monad</h1>
      <p class="f4 fw3 pab-100px tc tc-m tl-ns">2018-02-19</p>
    </div>
  </div>

  <div class="w-100 bt">
    <section class="pa2 mw8 center white">
      <a class="link white dim" href="https://typescriptmasterclass.com">
        🔥 Check out my <em>Advanced TypeScript Masterclass book</em> 🔥
      </a>
    </section>
  </div>
</div>


<!-- Content -->
<div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l">
    <div class="content">
        <div class="mw8 center">
            <div class="cf">
                <div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content">
                    <!-- Tags Vertical -->
                    
                        <div class="tags-container-vertical">
                            <div class="tags-sub-container">
                                <a class="fw3 ph1 dib" href="/tags/typescript/">#typescript</a> <a class="fw3 ph1 dib" href="/tags/functional-programming/">#functional programming</a> <a class="fw3 ph1 dib" href="/tags/monads/">#monads</a>
                            </div>
                        </div>
                    

                    <!-- Main Post Content -->
                    <p>With this post, I would like to start a short series about <strong>monads</strong>. If you are familiar with some functional programming techniques in JavaScript (such as immutability or pure functions), this is a great next step to go deeper into this amazing paradigm. Regardless of whether you’ve never heard about monads or have heard about them but never really understood them, this series will strive to explain then in simple, practical terms. </p>
<p>I’ve already tackled this topic on the blog a few times (see <a href="https://codewithstyle.info/understand-monads-linq/">monads in C#</a> and <a href="https://codewithstyle.info/scalas-option-monad-versus-null-conditional-operator-in-c/">monads in Scala</a>) but this time I would like to explore how monads can be useful in the front-end world. One final word - I chose TypeScript over JavaScript because it’s just easier to talk about monads in a strongly-typed language. You don’t have to be a TypeScript expert to understand the article. </p>
<p><strong>You can find all the code from the series in <a href="https://github.com/miloszpp/typescript-monads" target="_blank" rel="noopener">this repository</a>. Check the commit history for code relevant to the specific part of the series.</strong> </p>
<p>Let’s get ready for our monadic journey!</p>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>We’re going to build a simple application that implements the following scenario: <em>A company has a hierarchical employee structure (each employee can have another employee as a supervisor). As a user, I would like to be able to enter employee ID (a numeric value) and see their supervisor’s name.</em> Let’s start with a plain, non-monadic implementation. Here is some HTML for the user interface:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Find employee's supervisor<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"employeeId"</span>&gt;</span>Enter employee ID<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"employeeId"</span> <span class="attr">id</span>=<span class="string">"employeeIdInput"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"findEmployeeButton"</span>&gt;</span>Find supervisor's name<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"searchResults"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>The HTML consists of an input for the employee’s ID and a button to search for the employee’s supervisor’s name. And here comes the code that orchestrates this form:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; EmployeeRepository &#125; <span class="keyword">from</span> <span class="string">"./employee.repository"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> employeeIdInputEl = <span class="built_in">document</span>.getElementById(<span class="string">"employeeIdInput"</span>) <span class="keyword">as</span> HTMLInputElement;</span><br><span class="line"><span class="keyword">const</span> findEmployeeButtonEl = <span class="built_in">document</span>.getElementById(<span class="string">"findEmployeeButton"</span>);</span><br><span class="line"><span class="keyword">const</span> searchResultsEl = <span class="built_in">document</span>.getElementById(<span class="string">"searchResults"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> repository = <span class="keyword">new</span> EmployeeRepository();</span><br><span class="line"></span><br><span class="line">findEmployeeButtonEl.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> supervisorName = getSupervisorName(employeeIdInputEl.value);</span><br><span class="line">    <span class="keyword">if</span> (supervisorName) &#123;</span><br><span class="line">        searchResultsEl.innerText = <span class="string">`Supervisor name: <span class="subst">$&#123;supervisorName&#125;</span>`</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        searchResultsEl.innerText = <span class="string">"Could not find supervisor for given id"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSupervisorName</span>(<span class="params">enteredId: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (enteredId) &#123;</span><br><span class="line">        <span class="keyword">const</span> employee = repository.findById(<span class="built_in">parseInt</span>(enteredId));</span><br><span class="line">        <span class="keyword">if</span> (employee &amp;&amp; employee.supervisorId) &#123;</span><br><span class="line">            <span class="keyword">const</span> supervisor = repository.findById(employee.supervisorId);</span><br><span class="line">            <span class="keyword">if</span> (supervisor) &#123;</span><br><span class="line">                <span class="keyword">return</span> supervisor.name;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Firstly, we get hold of some HTML elements. Next, we attach a click handler to the button. Inside the handler, we invoke the <code>getSupervisorName</code> function which holds all of the actual logic (we will get back to it soon). Finally, we update the <code>p</code> tag with search results. Finally, let’s have a quick look at the <code>EmployeeRepository</code> class:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Employee &#125; <span class="keyword">from</span> <span class="string">"./employee.model"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> EmployeeRepository &#123;</span><br><span class="line">    <span class="keyword">private</span> employees: Employee[] = [</span><br><span class="line">        &#123; id: <span class="number">1</span>, name: <span class="string">"John"</span> &#125;,</span><br><span class="line">        &#123; id: <span class="number">2</span>, name: <span class="string">"Jane"</span>, supervisorId: <span class="number">1</span> &#125;,</span><br><span class="line">        &#123; id: <span class="number">3</span>, name: <span class="string">"Joe"</span>, supervisorId: <span class="number">2</span> &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    findById(id: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> results = <span class="keyword">this</span>.employees.filter(<span class="function"><span class="params">employee</span> =&gt;</span> employee.id === id);</span><br><span class="line">        <span class="keyword">return</span> results.length ? results[<span class="number">0</span>] : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It’s just an in-memory storage of the employee hierarchy with some hardcoded values. The <code>Employee</code> interface could look like this:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Employee &#123;</span><br><span class="line">    id: <span class="built_in">number</span>;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">    supervisorId?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Nesting-nesting-nesting"><a href="#Nesting-nesting-nesting" class="headerlink" title="Nesting, nesting, nesting"></a>Nesting, nesting, nesting</h2><p>As promised, let’s focus on the <code>getSupervisorName</code> function.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSupervisorName</span>(<span class="params">enteredId: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (enteredId) &#123;</span><br><span class="line">        <span class="keyword">const</span> employee = repository.findById(<span class="built_in">parseInt</span>(enteredId));</span><br><span class="line">        <span class="keyword">if</span> (employee &amp;&amp; employee.supervisorId) &#123;</span><br><span class="line">            <span class="keyword">const</span> supervisor = repository.findById(employee.supervisorId);</span><br><span class="line">            <span class="keyword">if</span> (supervisor) &#123;</span><br><span class="line">                <span class="keyword">return</span> supervisor.name;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>As we can see, the function body involves several levels of nesting. This is because many things can go wrong during the search for the supervisor.</p>
<ul>
<li>the user can click the button without typing anything in the ID field</li>
<li>there can be no employee for given ID</li>
<li>the employee we’re looking for can have no supervisor (e.g. they’re a CEO or an independent consultant)</li>
<li>there can be no employee with ID equal to the employee’s supervisor’s ID (inconsistency in the hierarchy)</li>
</ul>
<p>In other words, there are many operations involved and each of them can return an <strong>empty result</strong> (e.g. <strong>empty</strong> input field, <strong>empty</strong> search result, etc.). The function needs to handle all of these edge cases and hence the deep nesting of <code>if</code> statements. Is there anything wrong with it? I think yes:</p>
<ul>
<li>when writing such code, it’s easy to miss some of the edge cases and the compiler won’t stop us from doing so</li>
<li>such code is not very readable</li>
</ul>
<p>Let’s see how to solve both of these problems.</p>
<h2 id="Introducing-Maybe"><a href="#Introducing-Maybe" class="headerlink" title="Introducing Maybe"></a>Introducing <code>Maybe</code></h2><p>One way of simplifying code is to identify a pattern and create an abstraction that hides the implementation details of this pattern. The recurring theme in the <code>getSupervisorName</code> function is the nesting of <code>if</code> statements.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (result) &#123;</span><br><span class="line">  <span class="keyword">const</span> nextResult = operation(result);</span><br><span class="line">  <span class="keyword">if</span> (nextResult) &#123;</span><br><span class="line">     <span class="comment">// and so on...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="comment">// else stop</span></span><br></pre></td></tr></table></figure>
<p>But how to create an abstraction over such a pattern? The reason we have to do these <code>if</code> checks is that the value stored inside <code>result</code> can be empty. We’ll create a simple wrapper type that holds a simple value and is aware of whether the value is empty (ie. <code>null</code> or <code>undefined</code> or empty string) or not. Let’s call this wrapper type <code>Maybe</code>.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Maybe&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> value: T | <span class="literal">null</span></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> some&lt;T&gt;(value: T) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!value) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">"Provided value must not be empty"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Maybe(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> none&lt;T&gt;() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Maybe&lt;T&gt;(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> fromValue&lt;T&gt;(value: T) &#123;</span><br><span class="line">        <span class="keyword">return</span> value ? Maybe.some(value) : Maybe.none&lt;T&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getOrElse(defaultValue: T) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value === <span class="literal">null</span> ? defaultValue : <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Instances of <code>Maybe</code> hold a <code>value</code> that can either be an actual value or <code>null</code>. Here, <code>null</code> is the internal representation of an empty value. The constructor is private so you can only create <code>Maybe</code> instances by calling <code>some</code> or <code>none</code> static methods. <code>fromValue</code> is a convenience method that transforms a regular value to a <code>Maybe</code> instance. Finally, <code>getOrElse</code> is a safe way of extracting the value contained by <code>Maybe</code>. The caller has to provide the default value that will be used in case <code>Maybe</code> is empty. So far, so good. We can now explicitly say that the result returned by some method can be empty. Let’s change the <code>findById</code> method on <code>EmployeeRepository</code>:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">findById(id: <span class="built_in">number</span>): Maybe&lt;Employee&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> results = <span class="keyword">this</span>.employees.filter(<span class="function"><span class="params">employee</span> =&gt;</span> employee.id === id);</span><br><span class="line">    <span class="keyword">return</span> results.length ? Maybe.some(results[<span class="number">0</span>]) : Maybe.none();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that the return type of <code>findById</code> is now more meaningful and better captures the programmer’s intention. <code>findById</code> can indeed return an empty value if an employee with given ID doesn’t exist inside the repository. What’s more, we can change the <code>Employee</code> interface to explicitly state the fact that <code>supervisorId</code> can be empty:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Employee &#123;</span><br><span class="line">    id: <span class="built_in">number</span>;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">    supervisorId: Maybe&lt;<span class="built_in">number</span>&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We’ll now add some operations to make <code>Maybe</code> type more useful. You know the <code>map</code> method that you can call on arrays, right? It applies a given function to every element of an array. If we look at <code>Maybe</code> as at a special array that can have from zero to one elements, it turns out that defining <code>map</code> on it totally makes sense.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">map&lt;R&gt;<span class="function">(<span class="params">f: (<span class="params">wrapped: T</span>) =&gt; R</span>): <span class="params">Maybe</span>&lt;<span class="params">R</span>&gt; &#123;</span></span><br><span class="line"><span class="function">    <span class="params">if</span> (<span class="params"><span class="keyword">this</span>.value === <span class="literal">null</span></span>) &#123;</span></span><br><span class="line"><span class="function">        <span class="params">return</span> <span class="params">Maybe</span>.<span class="params">none</span>&lt;<span class="params">R</span>&gt;<span class="params">()</span>;</span></span><br><span class="line"><span class="function">    &#125; <span class="params">else</span> &#123;</span></span><br><span class="line"><span class="function">        <span class="params">return</span> <span class="params">Maybe</span>.<span class="params">fromValue</span>(<span class="params">f(<span class="params"><span class="keyword">this</span>.value</span>)</span>);</span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Our <code>map</code> takes a function <code>f</code> that transforms the element wrapped by <code>Maybe</code> and returns a new <code>Maybe</code> with the result of the transformation. If <code>Maybe</code> was a <code>none</code> then the result of <code>map</code> will also be an empty <code>Maybe</code> (just like calling <code>map</code> on an empty array would give you an empty array). <code>R</code> is the type parameter representing the type returned by <code>f</code> transformation. But how is this <code>map</code> useful? The original version of the <code>getSupervisorName</code> function included the below <code>if</code> statement:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> supervisor = repository.findById(employee.supervisorId);</span><br><span class="line"><span class="keyword">if</span> (supervisor) &#123;</span><br><span class="line">    <span class="keyword">return</span> supervisor.name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>But <code>findById</code> returns a <code>Maybe</code> now! And we have the <code>map</code> operation available which, accidentally, has exactly the same semantics as the <code>if</code> statement above! Therefore, we can rewrite the above piece like this:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> supervisor: Maybe&lt;Employee&gt; = repository.findById(employee.supervisorId);</span><br><span class="line"><span class="keyword">return</span> supervisor.map(<span class="function"><span class="params">s</span> =&gt;</span> s.name);</span><br></pre></td></tr></table></figure>
<p>Didn’t we just hide the <code>if</code> statement behind an abstraction? Yes, we did! However, we’re not ready to rewrite the whole function in such style yet.</p>
<h2 id="Maybe-map-or-maybe-flatMap"><a href="#Maybe-map-or-maybe-flatMap" class="headerlink" title="Maybe map, or maybe flatMap?"></a>Maybe <code>map</code>, or maybe <code>flatMap</code>?</h2><p>Using <code>map</code> works fine for transformations such as above. But how about this one?</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> employee = repository.findById(<span class="built_in">parseInt</span>(enteredId));</span><br><span class="line"><span class="keyword">if</span> (employee &amp;&amp; employee.supervisorId) &#123;</span><br><span class="line">    <span class="keyword">const</span> supervisor = repository.findById(employee.supervisorId);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We could try to rewrite it using <code>map</code>:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> employee: Maybe&lt;Employee&gt; = repository.findById(<span class="built_in">parseInt</span>(enteredId));</span><br><span class="line"><span class="keyword">const</span> supervisor: Maybe&lt;Maybe&lt;Employee&gt;&gt; = employee.map(<span class="function"><span class="params">e</span> =&gt;</span> repository.findById(e.supervisorId));</span><br></pre></td></tr></table></figure>
<p>See the problem? The type of <code>supervisor</code> is <code>Maybe&lt;Maybe&lt;Employee&gt;&gt;</code>. This is because our transformation function now maps from a regular value to a <code>Maybe</code> (and previously it was mapping from regular value to a regular value). Is there a way to transform <code>Maybe&lt;Maybe&lt;Employee&gt;&gt;</code> to a simple <code>Maybe&lt;Employee&gt;</code>? In other words, we would like to <strong>flatten</strong> our <code>Maybe</code>. Again, there is an analogy to arrays. You can flatten nested array <code>[[1, 2, 3], [4, 5, 6]]</code> to <code>[1, 2, 3, 4, 5, 6]</code>. We’ll add a new operation to <code>Maybe</code> and call it <code>flatMap</code>. It’s just like <code>map</code> but it also flattens the result so that we don’t end up with nested <code>Maybe</code>s.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">flatMap&lt;R&gt;<span class="function">(<span class="params">f: (<span class="params">wrapped: T</span>) =&gt; Maybe&lt;R&gt;</span>): <span class="params">Maybe</span>&lt;<span class="params">R</span>&gt; &#123;</span></span><br><span class="line"><span class="function">    <span class="params">if</span> (<span class="params"><span class="keyword">this</span>.value === <span class="literal">null</span></span>) &#123;</span></span><br><span class="line"><span class="function">        <span class="params">return</span> <span class="params">Maybe</span>.<span class="params">none</span>&lt;<span class="params">R</span>&gt;<span class="params">()</span>;</span></span><br><span class="line"><span class="function">    &#125; <span class="params">else</span> &#123;</span></span><br><span class="line"><span class="function">        <span class="params">return</span> <span class="params">f</span>(<span class="params"><span class="keyword">this</span>.value</span>);</span></span><br><span class="line"><span class="function">    &#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
<p>The implementation is pretty simple. If given instance of <code>Maybe</code> is not empty then we extract the wrapped value, apply the provided function and simply return the result (which can either be empty or not empty). If the instance was empty, we simply return an empty <code>Maybe</code>. Note the type signature of <code>f</code>. Previously, it was mapping from <code>T</code> to <code>R</code>. Now, it’s mapping from <code>T</code> to <code>Maybe&lt;R&gt;</code>. Thanks to the addition of <code>flatMap</code>, we can now rewrite the above code piece like this:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> employee: Maybe&lt;Employee&gt; = repository.findById(<span class="built_in">parseInt</span>(enteredId));</span><br><span class="line"><span class="keyword">const</span> supervisor: Maybe&lt;Employee&gt; = employee.flatMap(<span class="function"><span class="params">e</span> =&gt;</span> repository.findById(e.supervisorId));</span><br></pre></td></tr></table></figure>
<h2 id="Maybe-Monad-in-action"><a href="#Maybe-Monad-in-action" class="headerlink" title="Maybe Monad in action"></a>Maybe Monad in action</h2><p>Now, we’ve got all we need to rewrite the <code>getSupervisorName</code> function.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getSupervisorName</span>(<span class="params">maybeEnteredId: Maybe&lt;<span class="built_in">string</span>&gt;</span>): <span class="title">Maybe</span>&lt;<span class="title">string</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> maybeEnteredId</span><br><span class="line">        .flatMap(<span class="function"><span class="params">employeeIdString</span> =&gt;</span> Maybe.fromValue(<span class="built_in">parseInt</span>(employeeIdString))) <span class="comment">// parseInt can fail</span></span><br><span class="line">        .flatMap(<span class="function"><span class="params">employeeId</span> =&gt;</span> repository.findById(employeeId))</span><br><span class="line">        .flatMap(<span class="function"><span class="params">employee</span> =&gt;</span> employee.supervisorId)</span><br><span class="line">        .flatMap(<span class="function"><span class="params">supervisorId</span> =&gt;</span> repository.findById(supervisorId))</span><br><span class="line">        .map(<span class="function"><span class="params">supervisor</span> =&gt;</span> supervisor.name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We’ve eliminated all of the nested <code>if</code> statements! The <code>getSupervisorName</code> function’s body is now an elegant pipeline of transformations applied to the input value. We’ve hidden the details of handling empty results because they’re just boilerplate and obfuscate the real intention of the code. They’re now taken care of by <code>Maybe</code>. Note that if any of the operations inside <code>flatMap</code> returned a <code>none</code>, it would cause the whole thing to immediately return a <code>none</code>. This is actually the same behaviour that we had with nested <code>if</code> statements. Here is an example of how the function can be used inside the click handler:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">findEmployeeButtonEl.addEventListener(<span class="string">"click"</span>, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> supervisorName = getSupervisorName(Maybe.fromValue(employeeIdInputEl.value));</span><br><span class="line">    searchResultsEl.innerText = <span class="string">`Supervisor name: <span class="subst">$&#123;supervisorName.getOrElse("could not find")&#125;</span>`</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>And, guess what, <code>Maybe</code> is a <strong>monad</strong>! The formal definition of a monad is that it’s a container type that has two operations:</p>
<ul>
<li><code>return</code> - which creates an instance of the type from a regular value (<code>some</code> and <code>none</code> in our case)</li>
<li><code>bind</code> - which lets you combine monadic values (<code>flatMap</code> in our case)</li>
</ul>
<p>There are also some monadic laws that every monad has to follow but let’s not dive into it yet. For now, you have to trust me that our <code>Maybe</code> implementation follows these laws :)</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>In this first post of the series, we’ve created our first monad. The purpose of the <code>Maybe</code> monad is to abstract away handling of empty values. Thanks to the introduction of this type, we can now write code without having to worry about empty results. In the next article, we’ll see how thanks to TypeScript we can write code that uses monads in an even more readable way. Do you find monads interesting? Do you feel like you understand the concept now or is it still a mystery? <strong>Please let me know in comments!</strong></p>


                    
<hr>
<p class="f5 bg-dark-gray br3 pa3 white">
  Did you like this TypeScript article? I bet you'll also like my book!<br>
  <a href="https://typescriptmasterclass.com">
    ⭐️ Advanced TypeScript E-book ⭐️
  </a>
</p>



                    <div class="social-sharing pv3">
                      <h5 class="mv1">Enjoyed it? Let others hear about it too! ❤️</h5>
                      <div class="flex items-center">
                        <a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Advanced functional programming in TypeScript: Maybe monad by @miloszpp" data-size="large">
                          Tweet
                        </a>
                        <div class="fb-share-button mh1" data-href="616.html" data-layout="button_count" data-size="large">
                        </div>
                      </div>
                    </div>
                    
                    <!-- Tags Bottom -->
                    
                        <div class="tags-container-bottom">
                            <i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/tags/typescript/">#typescript</a> <a class="fw3 ph1 dib" href="/tags/functional-programming/">#functional programming</a> <a class="fw3 ph1 dib" href="/tags/monads/">#monads</a>
                        </div>
                    

                    <!-- Comments -->
                    
<div id="disqus_thread" class="mt5">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>



                    

                </div>
                <div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50">
                <hr class="dn-l mw4 black-50 mt5">

<div class="mt5 mt0-l">
    <article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3">
        <div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width: 6rem;">
            <img src="/images/speaker-avatar-2.png" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="Miłosz Piechocki">
        </div>
        <div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">
            Hi! My name is Miłosz Piechocki. I’m a software developer living in Warsaw, Poland. I’m passionate about TypeScript, JavaScript and functional programming in modern web development.
        </div>
        <div class="mt3">
          <a class="twitter-follow-button" data-show-count="false" href="https://twitter.com/miloszpp">
            Follow me on Twitter</a>
        </div>
    </article>
</div>

<hr class="dn-l mw4 black-50 mt5">

<div class="mt5 tc tl-l">
  <h3>Free download</h3>
  <a href="/10tips"><img src="/images/10tips.png"></a>
</div>

<hr class="dn-l mw4 black-50 mt5">

                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
<div class="bg-1 ph2 ph5-ns pv5">
    <div class="mv8">
        <div class="center tc">
            
                <div class="dib mh3">
                    <a class="f3 f2-ns white dim" href="http://twitter.com/miloszpp/" target="_blank">
                        <i class="fab fa-twitter"></i>
                    </a>
                </div>
            
                <div class="dib mh3">
                    <a class="f3 f2-ns white dim" href="http://facebook.com/codewithstyle.info/" target="_blank">
                        <i class="fab fa-facebook"></i>
                    </a>
                </div>
            
                <div class="dib mh3">
                    <a class="f3 f2-ns white dim" href="https://github.com/miloszpp" target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                </div>
            
                <div class="dib mh3">
                    <a class="f3 f2-ns white dim" href="https://www.youtube.com/channel/UC_DEBDpgRyBZAT85tJ1QZBw" target="_blank">
                        <i class="fab fa-youtube"></i>
                    </a>
                </div>
            
                <div class="dib mh3">
                    <a class="f3 f2-ns white dim" href="mailto:milosz@miloszpiechocki.com" target="_blank">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            
                <div class="dib mh3">
                    <a class="f3 f2-ns white dim" href="/atom.xml" target="_blank">
                        <i class="fas fa-rss"></i>
                    </a>
                </div>
            
        </div>
        <div class="f6 f5-ns center tc white pt5 fw3">
            @Copyright Miłosz Piechocki. All right reserved | Design & Hexo based on Anodyne by <a class="link dim white" href="http://www.codeblocq.com/">Jonathan Klughertz</a>
        </div>
    </div>
</div>

  <!-- Load Facebook SDK for JavaScript -->
  <div id="fb-root"></div>
  <script>(function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));</script>

<!-- After Footer -->
<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'codewithstyle';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>